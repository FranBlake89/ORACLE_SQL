/*
CreateTable.SQL
*********************************************************************
FINAL PROJECT DBS-211
*********************************************************************
Names: 
    1.Raymond Javier
    2.Francisco Castillo
    3.Gurleen

Version 1.0
+ Creation of tables

*********************************************************************
*/
SET ECHO OFF;

-- TABLE DROP STATEMENTS

SET VERIFICATION OFF

BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE status_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE users_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE books_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE librarians_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE sections_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE catalogs_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE records_library CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/


/* NEW TABLE CREATION */ 
PROMPT '*******  Starting Table Creation';

-- STATUS Table Structure (DDL)
PROMPT '******* Create status table';
CREATE TABLE status_library (
    STATUS VARCHAR2(20) NOT NULL,
    BOOKLIMIT NUMBER(2,0) NOT NULL,
    PRIMARY KEY(STATUS)
);


-- USERS Table Structure (DDL)
PROMPT '******* Create users table';
CREATE TABLE users_library (
    LIBRARY_ID NUMBER(8,0) NOT NULL,
    FIRSTNAME VARCHAR2(30) NOT NULL,
    LASTNAME VARCHAR2(30) NOT NULL,
    PHONE NUMBER(10,0) NOT NULL,
    EMAIL VARCHAR2(125) DEFAULT NULL,
    DOB DATE NOT NULL,
    PHYLOSOPHY NUMBER(1) DEFAULT 0,
    HORROR NUMBER(1) DEFAULT 0,
    SCIENCE NUMBER(1) DEFAULT 0,
    FICTION NUMBER(1) DEFAULT 0,
    MYSTERY NUMBER(1) DEFAULT 0,
    SCIENCEFICTION NUMBER(1) DEFAULT 0,
    PASSWORD VARCHAR2(50) NOT NULL,
    STATUS VARCHAR2(20) NOT NULL,
    PRIMARY KEY (LIBRARY_ID),
    CONSTRAINT status_fk FOREIGN KEY (STATUS) REFERENCES STATUS_LIBRARY(STATUS)
);


-- BOOKS Table Structure (DDL)
PROMPT '******* Create books table';
CREATE TABLE books_library (
    BOOK_ID NUMBER(8,0) NOT NULL,
    TITLE VARCHAR2(100) NOT NULL,
    PUBLISHER VARCHAR2(50) NOT NULL,
    YEAR NUMBER(4,0) NOT NULL,
    AUTHOR VARCHAR2(60) NOT NULL,
    TOTALNUMBER NUMBER(2,0) DEFAULT 0,
    DAYS NUMBER(3,0) DEFAULT 7,
    FINES NUMBER(5,2) DEFAULT 0,
    PRIMARY KEY (BOOK_ID)
);

-- LIBRARIANS Table Structure (DDL)
PROMPT '******* Create librarians table';
CREATE TABLE librarians_library (
    EMPLOYEE_ID NUMBER(8,0) NOT NULL,
    FIRSTNAME VARCHAR2(30) NOT NULL,
    LASTNAME VARCHAR2(30) NOT NULL,
    PHONE NUMBER(10,0) NOT NULL,
    EMAIL VARCHAR2(125) DEFAULT NULL,
    DOB DATE NOT NULL,
    MANAGER_ID NUMBER(8,0) DEFAULT NULL,
    POSTITION VARCHAR2(20) DEFAULT 'Librarians',
    PASSWORD VARCHAR2(50) DEFAULT 'P@ssw0rd',
    PRIMARY KEY (EMPLOYEE_ID),
    CONSTRAINT employee_fk FOREIGN KEY (MANAGER_ID) REFERENCES LIBRARIANS_LIBRARY(EMPLOYEE_ID)
);

-- SECTIONS Table Structure (DDL)
PROMPT '******* Create sections table';
CREATE TABLE sections_library (
    SECTION_ID VARCHAR2(4) NOT NULL,
    SECTIONNAME VARCHAR2(30) NOT NULL,
    DESCRIPTION VARCHAR2(100) DEFAULT NULL,
    GENRE VARCHAR2(30) NOT NULL,
    EMPLOYEE_ID NUMBER(8,0) NOT NULL,
    PRIMARY KEY (SECTION_ID),
    CONSTRAINT employee_sec_fk FOREIGN KEY (EMPLOYEE_ID) REFERENCES LIBRARIANS_LIBRARY(EMPLOYEE_ID)
);

-- CATALOGS Table Structure (DDL)
PROMPT '******* Create catalogs table';
CREATE TABLE catalogs_library (
    SECTION_ID VARCHAR2(4) NOT NULL,
    BOOK_ID NUMBER(8,0) NOT NULL,
    PRIMARY KEY (SECTION_ID, BOOK_ID),
    CONSTRAINT section_fk FOREIGN KEY (SECTION_ID) REFERENCES SECTIONS_LIBRARY(SECTION_ID),
    CONSTRAINT book_fk FOREIGN KEY (BOOK_ID) REFERENCES BOOKS_LIBRARY(BOOK_ID)
);

-- RECORDS Table Structure (DDL)
PROMPT '******* Create records table';
CREATE TABLE records_library (
    RECORD_ID NUMBER(8,0) NOT NULL,
    LIBRARY_ID NUMBER(8,0) NOT NULL,
    BOOK_ID NUMBER(6,0) NOT NULL,
    EMPLOYEE_ID NUMBER(8,0) NOT NULL,
    DUEDATE DATE NOT NULL,
    BORROWDATE DATE NOT NULL,
    RETURNDATE DATE NULL,
    PRIMARY KEY (RECORD_ID),
    CONSTRAINT library_fk FOREIGN KEY (LIBRARY_ID) REFERENCES USERS_LIBRARY(LIBRARY_ID),
    CONSTRAINT book_rec_fk FOREIGN KEY (BOOK_ID) REFERENCES BOOKS_LIBRARY(BOOK_ID),
    CONSTRAINT employee_rec_fk FOREIGN KEY (EMPLOYEE_ID) REFERENCES LIBRARIANS_LIBRARY(EMPLOYEE_ID)
);
